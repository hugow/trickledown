<html>
<head>
<link rel="StyleSheet" href="stylesheets/site.css" type="text/css" media="screen">
<link type="text/css" href="stylesheets/ui-lightness/jquery-ui-1.8.16.custom.css" rel="Stylesheet" />
<script type="text/javascript" src="javascripts/jquery-1.6.2.min.js"></script>
<script type="text/javascript" src="javascripts/jquery-ui-1.8.16.custom.min.js"></script>
<script type="text/javascript" src="javascripts/gcharts/jquery.gchart.js"></script>
<script>
    $(document).ready(function () {
        window.console.log('xx1');
        $( "#tabs" ).tabs();

        function updateHistogram(world, histogram) {
            // chart 1
            $('div.' + world + ' div.worldchart1').gchart({
                title: '% of total money per wealth category',
                type: 'barVert',
                dataLabels: histogram.dataLabels,
                legend: 'right',
                series: [
                    $.gchart.series('% of total money', histogram.percent, 'green', 0, 1)
                ]
            });
            // chart 2
            $('div.' + world + ' div.worldchart2').gchart({
                title: 'Number of Players per wealth category',
                type: 'barVert',
                dataLabels: histogram.dataLabels,
                legend: 'right',
                series: [
                    $.gchart.series('Number of People', histogram.number, 'green', 0, 100)
                ]
            });
        }

        function updateRanking(world, values) {
            var str = '<table>', i;
            for (i = 0; i < values.length; i += 1) {
                str += '<tr><td>' + values[i].username + '</td><td>' + values[i].value + '$</td></tr>';
            }
            str += '</table>';
            console.log(str);
            console.log(values);
            $('div.' + world + ' div.playerranking').html(str);
        }

        function updateOtherStats(world, values) {
            var str = '<table>', i;
            for (i = 0; i < values.length; i += 1) {
                str += '<tr><td>' + values[i].name + '</td><td>' + values[i].value + '$</td></tr>';
            }
            str += '</table>';
            console.log(str);
            console.log(values);
            $('div.' + world + ' div.otherstats').html(str);
        }


        function setupSimulation () {
            var requests = [];
            // set an interval to reload the world (we know it updates constantly,
            // there is no point in being notified)
            setInterval(function () {
                // abort all pending ajax requests
                requests.forEach(function (req) {
                    req.abort();
                });
                // queue more requests
                requests.push($.get('/worlds/opov',
                    function (data, textStatus, jqXHR) {
                        window.console.log(data);
                        updateHistogram('opov', data.moneyDistribution);
                        updateRanking('opov', data.topPlayers);
                        updateOtherStats('opov', [ { name: 'test', value: 'v' }]);
                        updateOtherStats('opov', data.statistics);
                    },
                    'json'
                ));
                requests.push($.get('/worlds/odov',
                    function (data, textStatus, jqXHR) {
                        window.console.log(data);
                        updateHistogram('odov', data.moneyDistribution);
                        updateRanking('odov', data.topPlayers);
                        updateOtherStats('odov', data.statistics);
                    },
                    'json'
                ));
            }, 3300);
        }
        setupSimulation();
    });
</script>
</head>
<body>
    <div id = 'outerzone'>
        <div id = 'appzone'>
            <div id = 'headerzone'>
                <div class='bigtitle'>TrickleDown</div>
                <div class='smalltitle'>too big to fail</div>
            </div>
            <div id = 'mainzone'>

                <div class="demo">
                    <div id="tabs">
	                    <ul>
		                    <li><a href="#tabs-1">World</a></li>
		                    <li><a href="#tabs-2">Play</a></li>
		                    <li><a href="#tabs-3">About</a></li>
	                    </ul>
	                    <div id="tabs-1" class='myThing'>
	                        <p>TrickleDown is an economic simulation, a game and
	                        an experiment at the same time. There are two
	                        worlds: the first one gives everyone an equal vote
	                        and the second one gives wealthier people
	                        more voting power.</p>

	                        <p>Voting lets you decide who should be taxed, the
	                        rich or the poor and how the money will be spent:
	                        by redistributing equally to all citizens or by
	                        helping the corporations in hope that they will
	                        give better opportunities to everyone in return.</p>

	                        <p>What world will be more succesful? If you play,
	                        remember that your goal is climb to the top and
	                        to stay there.</p>

	                        <div class='opov'>
	                            <h2>One man one vote</h2>

	                            <div class = 'sectioncomment' >
	                                Top Players
	                            </div>
	                            <div class = 'playerranking'>

	                            </div>

	                            <div class = 'sectioncomment' >
	                                Percent of Total Money per Wealth Category
	                            </div>
	                            <div class='worldchart1'> </div>


	                            <div class = 'sectioncomment' >
	                                People per Wealth Category
	                            </div>
	                            <div class='worldchart2'> </div>


	                            <div class = 'sectioncomment' >
	                                Other stats
	                            </div>
	                            <div class='otherstats'> </div>

	                        </div>
	                        <div class='odov'>
	                            <h2>One dollar one vote</h2>

	                            <div class = 'sectioncomment' >
	                                Top Players
	                            </div>
	                            <div class = 'playerranking'>

	                            </div>

	                            <div class = 'sectioncomment' >
	                                Percent of Total Money per Wealth Category
	                            </div>
	                            <div class='worldchart1'> </div>


	                            <div class = 'sectioncomment' >
	                                People per Wealth Category
	                            </div>
	                            <div class='worldchart2'> </div>


	                            <div class = 'sectioncomment' >
	                                Other stats
	                            </div>
	                            <div class='otherstats'> </div>

	                        </div>
	                    </div>
	                    <div id="tabs-2">
		                    <p>Use a username and password of your choice
		                    then control the corresponding character.</p>
		                    <input type='text'>
		                    <input type='text'>

                            <div class='opov'>
	                            <h2>One man one vote</h2>
	                            <div>
	                            Voting Profile
	                            taxThePoor
	                            taxTheRich
	                            redistributeToCorporations
	                            </div>
	                            <div>
	                            Spending Profile
	                            goods
	                            education
	                            savings
	                            investments
	                            </div>
	                            <div>
	                            Investment Profile
	                            </div>
	                        </div>
                            <div class='odov'>
	                            <h2>One dollar one vote</h2>
	                        </div>


	                    </div>
	                    <div id="tabs-3">
		                    <p>This game blabla bla</p>
	                    </div>
                    </div>

                </div><!-- End demo -->

            </div>
        </div>
    </div>
</body>
</html>
